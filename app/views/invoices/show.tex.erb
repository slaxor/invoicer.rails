\documentclass[10pt,twoside,ngerman]{article}
\usepackage{newcent}
\renewcommand{\ttdefault}{newcent}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[a4paper]{geometry}
\geometry{verbose,tmargin=2cm,bmargin=2cm,lmargin=2cm,rmargin=1cm,headheight=0cm,headsep=0cm,footskip=0cm}
\pagestyle{empty}
\setcounter{secnumdepth}{5}
\usepackage{array}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
%% Because html converters don't know tabularnewline
\providecommand{\tabularnewline}{\\}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.

\usepackage{newcent}\usepackage{rotating}\usepackage[right]{eurosym}


\usepackage{calc}

\makeatletter
\providecommand{\tabularnewline}{\\}

\usepackage{babel}\makeatother


\makeatother

\usepackage{babel}
\makeatother
\begin{document}
\vspace{1cm}

\begin{minipage}[t][1\totalheight]{1\columnwidth}%
\label{sender address}<%= @invoice.invoicing_party.name %>

<%= @invoice.invoicing_party.street %>

<%= @invoice.invoicing_party.post_code %> <%= @invoice.invoicing_party.city %>%
\end{minipage}%


\vspace{4cm}


%
\begin{minipage}[t][20mm]{70mm}%
\underbar{\tiny <%= @invoice.invoicing_party.name %> | <%= @invoice.invoicing_party.street %> | <%= @invoice.invoicing_party.post_code %> <%= @invoice.invoicing_party.city %>}{\tiny \par}

\label{recipient address}<%= @invoice.contact.name %>

<%= @invoice.contact.street %>\\

\textbf{<%= @invoice.contact.post_code %> <%= @invoice.contact.city %>}
\end{minipage}%
\hfill{}<%= @invoice.invoicing_party.city %>, <%= @invoice.printed_at.to_s(:german_date) %>

\vspace{2cm}


\textbf{\textsc{\huge Rechnung}}{\huge \par}
Rechnungsnummer <%= @invoice.number %>
\vspace{2cm}


\begin{tabular}{|l|l|l|l|r|r|r|r|}
Anfang&
Ende&
Pausen&
Beschreibung&
Stunden&
Preis (Netto)&
Mwst&
Preis (Brutto)\tabularnewline
\hline
<%- sum_hours = 0 -%>
<%- sum_price = 0 -%>
<%- sum_vat = 0 -%>
<%- sum_gross_price = 0 -%>

<%- @invoice.service_invoice_items.each do |invoice_item| -%>
  <%- hours = invoice_item.ended_at - invoice_item.started_at -%>
  <%- sum_hours += hours -%>
  <%= invoice_item.started_at.to_s(:medium) %>&
  <%= invoice_item.ended_at.to_s(:medium) %>&
  <%= invoice_item.pause_times %>&
  <%= invoice_item.description %>&
  <%= hours = invoice_item.ended_at - invoice_item.started_at %>&
  <%= price = invoice_item.pricing %>&
  <%- sum_price += price -%>
  <%= vat = invoice_item.pricing * invoice_item.vat_rate %> (<%= invoice_item.vat_rate * 100 %>\%)&
  <%- sum_vat += vat -%>
  <%= gross_price = price + vat %>\tabularnewline
  <%- sum_gross_price += gross_price -%>
<%- end -%>
\hline
\multicolumn{8}{r|}{Netto <%= sum_price %>\EUR}\tabularnewline
\multicolumn{8}{r|}{<%= sum_vat %>\EUR}\tabularnewline
\multicolumn{8}{r|}{\textbf{Zu Zahlender Betrag <%= (sum_gross_price) %>\EUR}}\tabularnewline
\end{tabular}
\vfill{}
\begin{tabular}{>{\raggedright}p{0.25\paperwidth}|>{\raggedright}p{0.25\paperwidth}|>{\raggedright}p{0.25\paperwidth}}
\hline
{\tiny <%= @invoice.invoicing_party.name %>}{\tiny \par}
{\tiny <%= @invoice.invoicing_party.street %>}{\tiny \par}
{\tiny <%= @invoice.invoicing_party.post_code %> <%= @invoice.invoicing_party.city %>}{\tiny \par}
& {\tiny <%= @invoice.invoicing_party.email %>}{\tiny \par}
{\tiny <%= @invoice.invoicing_party.telephone %>}{\tiny \par}
{\tiny USt-IdNr. <%= @invoice.invoicing_party.vatid %>}
& {\tiny <%= @invoice.invoicing_party.bank_account_number %>}{\tiny \par}
{\tiny <%= @invoice.invoicing_party.bank_sort_code %>}{\tiny \par}
{\tiny <%= @invoice.invoicing_party.bank %>}\tabularnewline
\end{tabular}
{\tiny Dieses Dokument wurde mit \LaTeX erstellt}
\end{document}

